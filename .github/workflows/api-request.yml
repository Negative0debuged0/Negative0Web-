name: Update Gist

on:
  push:
    branches:
      - main

jobs:
  update-gist:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Update Gist with new messages
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}  # Use the GH_TOKEN secret
        run: |
          # Fetch the latest chat.json content
          CONTENT=$(cat chat.json)
          
          # Make the API request to update the Gist
          curl -X PATCH \
            -H "Authorization: Bearer $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            -d @- <<EOF
          {
            "files": {
              "chat.json": {
                "content": "$CONTENT"
              }
            }
          }
          EOF

